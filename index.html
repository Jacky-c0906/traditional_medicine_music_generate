<script>
  const API_URL = "https://suno-submit-htkcgbflzs.cn-shenzhen.fcapp.run";
  const $ = (id)=>document.getElementById(id);
  const log = (v)=>{ const el = $("log"); if (el) el.textContent = typeof v==="string" ? v : JSON.stringify(v,null,2); };

  async function apiCall(payload){ /* 保持不变 */ }
  async function poll(taskId){ /* 保持不变 */ }

  document.addEventListener("DOMContentLoaded", ()=>{
    const btn = $("btn");
    if (!btn) { console.warn("未找到 id=btn 的按钮"); return; }

    btn.addEventListener("click", async ()=>{
      btn.disabled = true;
      const promptEl = $("prompt"), durationEl = $("duration"), instEl = $("instrumental"), modelEl = $("model");
      const prompt = promptEl?.value?.trim() || "";
      const duration = parseInt(durationEl?.value || "60", 10);
      const instrumental = (instEl?.value === "true");
      const model = modelEl?.value || "chirp-v4-5";

      log("Submitting...");
      try{
        const res = await apiCall({ prompt, duration, instrumental, model });
        log(res);
        const taskId = res.task_id || res.id || null;
        if(taskId){ await poll(taskId); }
        else { log("已提交。后端未返回 task_id"); }
      }catch(e){
        log(`请求失败：${e}`);
      }finally{
        btn.disabled = false;
      }
    });
  });
</script>
